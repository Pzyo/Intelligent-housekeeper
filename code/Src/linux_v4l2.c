#include <stdio.h>#include <sys/types.h>#include <sys/stat.h>#include <fcntl.h>#include <unistd.h>#include <strings.h>#include <linux/input.h>#include "jpeglib.h"#include "api_v4l2.h"extern int Flag ;extern int Mod ;int photo_num = -1;FrameBuffer freambuf;void * Linux_Video( void * arg){	int video_num = -1;	int fd_pic_file = -1 ;	int ret = -1 ; 	char * Video_name = malloc(20)  ;		//int num = -1 ;	//定义结构体变量	lcd_init();	/* 初始化摄像头设备*/	linux_v4l2_device_init("/dev/video3");	/* 启动摄像头*/	linux_v4l2_start_capturing();		char * jpg_name = malloc(20)  ;	char * Video = malloc(50);	char * tmp = "./Video/%d.jpg";		while(1)	{		//获取摄像头捕捉的画面		linux_v4l2_get_fream(&freambuf);		if(Flag == 40)			show_video_data(80, 0, freambuf.buf , freambuf.length);				else if(Flag == 42)		{			show_video_data(80, 0, freambuf.buf , freambuf.length);						photo_num ++ ;					bzero(jpg_name , 20);			sprintf( jpg_name,"./Video/%d.jpg", photo_num);			//打开一个新的文件			fd_pic_file = open(jpg_name, O_RDWR | O_CREAT | O_TRUNC , 0666);			if ( -1 == fd_pic_file)			{				perror("open pic error ");			}			//写入摄像头数据			ret = write ( fd_pic_file , freambuf.buf , freambuf.length);			printf(" Write:%d\n", ret  );			//关闭文件(如果没关闭相当没保存)			close(fd_pic_file);						if ( photo_num >= 150 )			{				video_num ++ ;				bzero(Video_name , 20);				sprintf( Video_name,"./Video/%d.avi", video_num);				//printf("%d\n\n\n",video_num);				sprintf(Video,"ffmpeg %s%s -f image2 -i %s", " ",Video_name,tmp);				printf("%s\n\n\n",Video);				system(Video); 								//system("ffmpeg -f image2 -i ./Video/%d.jpg ./Video/123.avi");				system("rm ./Video/*.jpg");				Flag = 0;			}		}	}		linux_v4l2_yuyv_quit();		//lcd_close();	return 0;}int linux_v4l2(void){			int fd_pic_file = -1 ;	int ret = -1 ; 	int num = -1;	char * Video_jpg_name = malloc(20)  ;			while(1)	{		if(Flag == 41)		{			bmp_show("./BMPphoto/main.bmp");			Mod = 0;			Flag = 0;			break;		}						else if(Flag == 43)		{			num ++ ;					bzero(Video_jpg_name , 20);			sprintf( Video_jpg_name,"./JPG/%d.jpg", num);			fd_pic_file = open( Video_jpg_name, O_RDWR | O_CREAT | O_TRUNC , 0666);			if ( -1 == fd_pic_file)			{				perror("open pic error ");			}			//写入摄像头数据			ret = write ( fd_pic_file , freambuf.buf , freambuf.length);			printf(" Write:%d\n", ret  );			//关闭文件(如果没关闭相当没保存)			close(fd_pic_file);			Flag = 40;		}				else if(Flag == 44)		{			bmp_show("./BMPphoto/xiangce.bmp");			Mod = 2;			Flag = 2;			break;		}	}	return 0;}/*	尝试实现拍照功能 */